<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>강가 - Scenes 1-4</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family:'Press Start 2P', monospace; }
    #guide { position:absolute; top:10px; width:100%; text-align:center; font-size:14px; }

    /* Scene1 */
    #text-container { position:absolute; top:60px; left:10px; right:10px; font-size:17px; line-height:1.2; color:#fff; }
    #text-container p { margin:4px 0; }

    /* Fade 애니메이션 (색상은 JS에서 설정) */
    .fade { animation: fadeToColor 3s forwards; }
    @keyframes fadeToColor { from{} to{} }

    /* Scene2 */
    #scene2-intro { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; font-size:19px; color:#000; }
    #chat-box { display:none; position:absolute; bottom:20px; left:10px; right:10px; background:rgba(0,0,0,0.6); border:1px solid #fff; padding:10px; font-size:19px; color:#fff; line-height:1.2; }
    #chat-box p { margin:4px 0; }

    /* Scene3 선택지 */
    #choice-container { display:none; position:absolute; top:0; left:0; width:100%; height:100%; }
    .choice { position:absolute; width:100%; height:50%; display:flex; justify-content:center; align-items:center; font-size:42px; color:#000; }
    #choice1 { top:0; border-bottom:1px solid #000; }
    #choice2 { bottom:0; }
    #scene3-chat { display:none; position:absolute; bottom:20px; left:10px; right:10px; background:rgba(0,0,0,0.6); border:1px solid #fff; padding:10px; font-size:18px; color:#fff; line-height:1.2; }
    #scene3-chat p { margin:4px 0; }

    /* Scene4 선택지 */
    #scene4-container { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background-color:#000; }
    .sc4choice { position:absolute; width:100%; height:50%; display:flex; justify-content:center; align-items:center; font-size:42px; color:#fff; }
    #sc4choice1 { top:0; border-bottom:1px solid #fff; }
    #sc4choice2 { bottom:0; }
    #original-img { display:none; position:absolute; top:0; left:0; width:100%; height:100%; object-fit:contain; }
  </style>
</head>
<body>
  <div id="guide">터치 화면을 누르며 진행</div>
  <div id="text-container"></div>
  <div id="scene2-intro"></div>
  <div id="chat-box"></div>
  <div id="choice-container">
    <div id="choice1" class="choice">1. 하늘을 바라본다</div>
    <div id="choice2" class="choice">2. ......집에 가야겠어.</div>
  </div>
  <div id="scene3-chat"></div>
  <div id="scene4-container">
    <div id="sc4choice1" class="sc4choice">원본 시를 보시겠습니까?</div>
    <div id="sc4choice2" class="sc4choice">현실로 돌아가기</div>
    <img id="original-img" src="original.jpg" alt="원본 시" />
  </div>
<script>
  let currentScene = 1;

  // Scene1
  const scene1Text = [
    "햇빛이 유리상자를 따갑게 두들긴다",
    "그 온도가 마음에 들지 않아 천천히 눈을 뜬다",
    "......물을 보러 가자.",
    "......",
    "물냄새.",
    "목소리.",
    "누군가 나에게 말을 건넨다",
    "저기 물 위에서 일렁이는 것이 보인다",
    "......",
    "내게 다가오고 있어."
  ];
  let s1idx = 0;
  function handleTouch(e) {
    if (currentScene === 1) {
      const c = document.getElementById('text-container');
      if (s1idx < scene1Text.length) {
        const p = document.createElement('p');
        p.innerText = scene1Text[s1idx++];
        c.appendChild(p);
      } else {
        currentScene = 2;
        document.getElementById('guide').style.display = 'none';
        applyFade('#000', '#fff');
        setTimeout(startScene2, 3000);
      }
    }
  }
  document.body.addEventListener('touchstart', handleTouch);
  document.body.addEventListener('mousedown', handleTouch);

  // Scene2
  const introText = "새 한 무리가 강물 위에서 헤엄친다<br>우리는 고향을 등지고 메마른 땅 위에 서 있다";
  const segs = [
    { clear: false, texts: ["우리는 바다에 터 잡은 조상을<br>뒤로 하고 육지로 상경했지", "결국 물이 그리워 향수병이 생겼어<br>아마 영원히 낫지 않을 거야"], img: 'scene2_bird_mobile.png' },
    { clear: true,  texts: ["병에 시달리는 삶이 애처롭기도 하고<br>한 편의 우화 연극 같기도 하고", "우리는 관객이며 동시에 배우인데<br>무대에 막이 내릴 기미는<br>보이지가 않네"], img: null },
    { clear: true,  texts: ["새와 눈이 마주친다<br>비웃는 표정으로 그가 하늘을 날아간다"], img: 'scene2_flying_bird.png' },
    { clear: false, texts: ["도시의 아스팔트 흙바닥을<br>아무리 오래 밟아도<br>근본이 변할 수는 없더라", "그래서 여기로 오는 거지<br>기쁠 때도 슬플 때도<br>귀성길에 오르는 거야<br>향수병을 달래기 위해……", "우리는 하늘을 날며 보았어<br>너희가 쌓아 올린 육지의 연장선을<br>참 끝도 없이 높더라!<br>새로운 고향을 찾으려는<br>그 노력이 재밌더라"], img: null }
  ];
  let segIdx = 0, txtIdx = 0;

  function startScene2() {
    currentScene = 2;
    removeFade();
    document.body.style.backgroundColor = '#fff';
    document.body.style.color = '#000';
    document.getElementById('text-container').style.display = 'none';
    document.getElementById('scene2-intro').innerHTML = introText;
  }
  function handleScene2(e) {
    if (currentScene !== 2) return;
    const intro = document.getElementById('scene2-intro');
    const chat  = document.getElementById('chat-box');
    if (!intro.dataset.shown) {
      intro.dataset.shown = true;
      return;
    }
    if (segIdx < segs.length) {
      const seg = segs[segIdx];
      if (txtIdx === 0) {
        if (seg.img) {
          document.body.style.backgroundImage = `url('${seg.img}')`;
          document.body.style.backgroundSize = 'cover';
        }
        chat.style.display = 'block';
        if (seg.clear) chat.innerHTML = '';
      }
      if (txtIdx < seg.texts.length) {
        const p = document.createElement('p');
        p.innerHTML = seg.texts[txtIdx++];
        chat.appendChild(p);
      } else {
        segIdx++;
        txtIdx = 0;
      }
    } else {
      currentScene = 3;
      chat.innerHTML = '';
      intro.innerHTML = '';
      applyFade('#fff', '#000');
      setTimeout(startScene3, 3000);
    }
  }
  document.body.addEventListener('touchstart', handleScene2);
  document.body.addEventListener('mousedown', handleScene2);

  // Scene3
  function startScene3() {
    removeFade();
    document.body.style.backgroundColor = '#fff';
    document.body.style.backgroundImage = '';
    document.getElementById('choice-container').style.display = 'block';
  }
  document.getElementById('choice1').addEventListener('touchstart', beginChoice1);
  document.getElementById('choice1').addEventListener('mousedown', beginChoice1);
  document.getElementById('choice2').addEventListener('touchstart', beginChoice2);
  document.getElementById('choice2').addEventListener('mousedown', beginChoice2);

  const scene3_1_segs = [
    ["새삼스럽게도 나는 하나의 사실을 깨달았다",
     "나는 매달려있다, 삼각기둥 하늘에서 뻗어 나온 일곱 가지 줄에 의해서",
     "내 눈길은 언제나 물을 향했지만",
     "나는 땅에서조차 스스로 발을 딛고 있지 않았다"],
    ["부탁이야", "이 줄을 끊어줘"],
    ["새가 비웃는다", "너는 스스로 할 수 있는 것이 아무것도 없구나"]
  ];
  let s3seg = 0, s3idx = 0;
  function beginChoice1() {
    currentScene = 4;
    document.getElementById('choice-container').style.display = 'none';
    const chat3 = document.getElementById('scene3-chat');
    chat3.style.display = 'block';
    chat3.innerHTML = '';
    document.body.style.backgroundImage = "url('sun_halo.webp')";
    document.body.style.backgroundSize = 'cover';
    applyFade('#fff','#fff');
    setTimeout(removeFade, 3000);
    document.body.addEventListener('touchstart', handleChoice1);
    document.body.addEventListener('mousedown', handleChoice1);
  }
  function handleChoice1(e) {
    const chat3 = document.getElementById('scene3-chat');
    if (s3seg === 0) {
      if (s3idx < scene3_1_segs[0].length) {
        const p = document.createElement('p');
        p.innerText = scene3_1_segs[0][s3idx++];
        chat3.appendChild(p);
      } else { s3seg = 1; s3idx = 0; }
    } else if (s3seg === 1) {
      chat3.innerHTML = '';
      scene3_1_segs[1].forEach(line => {
        const p = document.createElement('p');
        p.innerText = line;
        chat3.appendChild(p);
      });
      s3seg = 2;
    } else {
      chat3.innerHTML = '';
      chat3.style.fontSize = '21px';
      scene3_1_segs[2].forEach(line => {
        const p = document.createElement('p');
        p.innerText = line;
        chat3.appendChild(p);
      });
      applyFade('#000','#000');
      setTimeout(startScene4, 3000);
      document.body.removeEventListener('touchstart', handleChoice1);
      document.body.removeEventListener('mousedown', handleChoice1);
    }
  }

  function beginChoice2() {
    currentScene = 4;
    document.getElementById('choice-container').style.display = 'none';
    const chat3 = document.getElementById('scene3-chat');
    chat3.style.display = 'block';
    chat3.innerHTML = '';
    document.body.style.backgroundImage = "url('subway.png')";
    document.body.style.backgroundSize = 'cover';
    const p = document.createElement('p');
    p.innerText = "그래 오늘도 한강 공원은 갖가지 이유로 사람들이 북적이고 나는 이제 가야해 들개 우리같은 지하철에 몸을 맡기러, 새로운 고향으로 집 아닌 집으로 가야 하니까";
    chat3.appendChild(p);
    applyFade('#000','#000');
    setTimeout(startScene4, 3000);
  }

  // Scene4
  function startScene4() {
    removeFade();
    document.body.style.backgroundColor = '#000';
    document.body.style.backgroundImage = '';
    document.getElementById('scene3-chat').style.display = 'none';
    document.getElementById('scene4-container').style.display = 'block';
  }
  document.getElementById('sc4choice1').addEventListener('touchstart', () => {
    document.getElementById('scene4-container').style.display = 'none';
    document.getElementById('original-img').style.display = 'block';
  });
  document.getElementById('sc4choice1').addEventListener('mousedown', () => {
    document.getElementById('scene4-container').style.display = 'none';
    document.getElementById('original-img').style.display = 'block';
  });
  document.getElementById('sc4choice2').addEventListener('touchstart', () => window.close());
  document.getElementById('sc4choice2').addEventListener('mousedown', () => window.close());

  // Fade helper
  function applyFade(fromBg, toBg) {
    document.body.style.backgroundColor = fromBg;
    void document.body.offsetWidth; 
    document.body.classList.add('fade');
  }
  function removeFade() {
    document.body.classList.remove('fade');
  }
</script>
</body>
</html>
